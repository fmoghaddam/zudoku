import { jsx as _jsx, jsxs as _jsxs } from "react/jsx-runtime";
import * as Collapsible from "@radix-ui/react-collapsible";
import { MinusIcon, PlusIcon, RefreshCcwDotIcon } from "lucide-react";
import { useState } from "react";
import { Item, ItemActions, ItemContent, ItemTitle } from "zudoku/ui/Item.js";
import { InlineCode } from "../../../components/InlineCode.js";
import { Markdown } from "../../../components/Markdown.js";
import { Button } from "../../../ui/Button.js";
import { cn } from "../../../util/cn.js";
import { ConstValue } from "../components/ConstValue.js";
import { EnumValues } from "../components/EnumValues.js";
import { ParamInfos } from "../ParamInfos.js";
import { SchemaExampleAndDefault } from "./SchemaExampleAndDefault.js";
import { SchemaView } from "./SchemaView.js";
import { extractCircularRefInfo, isArrayCircularRef, isArrayType, isCircularRef, isComplexType, } from "./utils.js";
const RecursiveIndicator = ({ circularProp }) => (_jsxs(InlineCode, { className: "inline-flex items-center gap-1.5 text-xs translate-y-0.5", selectOnClick: false, children: [_jsx(RefreshCcwDotIcon, { size: 13 }), _jsx("span", { children: circularProp ? `${circularProp} (circular)` : "circular" })] }));
export const SchemaPropertyItem = ({ name, schema, group, defaultOpen = false, showCollapseButton = true, }) => {
    const [isOpen, setIsOpen] = useState(defaultOpen);
    if (isCircularRef(schema)) {
        return (_jsx(Item, { children: _jsxs(ItemContent, { className: "gap-y-2", children: [_jsxs("div", { children: [_jsx(ItemTitle, { className: "inline me-2", children: _jsx("code", { children: name }) }), "\u200B", _jsx(ParamInfos, { className: "inline", schema: schema, extraItems: [
                                    group !== "optional" && (_jsx("span", { className: "text-primary", children: "required" })),
                                    _jsx(RecursiveIndicator, {}, "circular-ref"),
                                ] })] }), _jsx(SchemaExampleAndDefault, { schema: schema })] }) }));
    }
    const isCollapsible = Boolean((schema.allOf ||
        schema.anyOf ||
        schema.oneOf ||
        isComplexType(schema) ||
        (isArrayType(schema) &&
            "items" in schema &&
            isComplexType(schema.items)) ||
        schema.additionalProperties) &&
        !isArrayCircularRef(schema));
    const shouldRenderDescription = Boolean(schema.description ||
        ("items" in schema && schema.items?.enum) ||
        schema.const ||
        schema.enum ||
        schema.example !== undefined ||
        schema.default !== undefined);
    return (_jsxs(Item, { children: [_jsxs(ItemContent, { className: "gap-y-2", children: [_jsxs("div", { children: [_jsx(ItemTitle, { className: "inline me-2", children: isCollapsible ? (_jsx("button", { onClick: () => setIsOpen(!isOpen), type: "button", className: "hover:underline", children: _jsx("code", { children: name }) })) : (_jsx("code", { children: name })) }), "\u200B", _jsx(ParamInfos, { className: "inline", schema: schema, extraItems: [
                                    group !== "optional" && (_jsx("span", { className: "text-primary", children: "required" })),
                                    isArrayCircularRef(schema) && (_jsx(RecursiveIndicator, { circularProp: extractCircularRefInfo(schema.items) })),
                                ] })] }), shouldRenderDescription && (_jsxs("div", { className: "flex flex-col gap-1.5", children: [schema.description && (_jsx(Markdown, { className: "prose-sm", content: schema.description })), "items" in schema && schema.items?.enum && (_jsx(EnumValues, { values: schema.items.enum })), schema.const && _jsx(ConstValue, { schema: schema, hideDescription: true }), schema.enum && _jsx(EnumValues, { values: schema.enum }), _jsx(SchemaExampleAndDefault, { schema: schema })] }))] }), isCollapsible && showCollapseButton && (_jsx(ItemActions, { className: "self-start", children: _jsx(Button, { variant: "ghost", size: "icon", className: "rounded-full", onClick: () => setIsOpen(!isOpen), "aria-label": "Toggle properties", children: isOpen ? _jsx(MinusIcon, { size: 16 }) : _jsx(PlusIcon, { size: 16 }) }) })), isCollapsible && (_jsx(Collapsible.Root, { defaultOpen: defaultOpen, open: isOpen, onOpenChange: setIsOpen, className: cn("w-full", !isOpen && "contents"), children: _jsx(Collapsible.Content, { asChild: true, children: _jsx(ItemContent, { children: schema.anyOf || schema.oneOf || schema.type === "object" ? (_jsx(SchemaView, { schema: schema })) : isArrayType(schema) && "items" in schema ? (_jsx(SchemaView, { schema: schema.items })) : null }) }) }))] }));
};
//# sourceMappingURL=SchemaPropertyItem.js.map