import { jsx as _jsx, jsxs as _jsxs } from "react/jsx-runtime";
import { ChevronDownIcon, CopyIcon, DownloadIcon, ExternalLinkIcon, } from "lucide-react";
import { Button } from "zudoku/components";
import { ButtonGroup } from "zudoku/ui/ButtonGroup.js";
import { DropdownMenu, DropdownMenuContent, DropdownMenuItem, DropdownMenuTrigger, } from "zudoku/ui/DropdownMenu.js";
import { useCopyToClipboard } from "../../util/useCopyToClipboard.js";
import { ChatGPTLogo } from "../markdown/assets/ChatGPTLogo.js";
import { ClaudeLogo } from "../markdown/assets/ClaudeLogo.js";
export const DownloadSchemaButton = ({ downloadUrl, }) => {
    const [, copyToClipboard] = useCopyToClipboard();
    const handleDownload = async (e) => {
        const isExternal = downloadUrl.includes("://");
        if (!isExternal)
            return;
        e.preventDefault();
        try {
            const response = await fetch(downloadUrl);
            if (!response.ok)
                throw new Error(`Failed to fetch: ${response.statusText}`);
            const blob = await response.blob();
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement("a");
            a.href = url;
            a.download = downloadUrl.split("/").pop() || "schema.json";
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
        }
        catch (error) {
            // biome-ignore lint/suspicious/noConsole: Logging error
            console.error("Failed to download schema:", error);
        }
    };
    return (_jsxs(ButtonGroup, { children: [_jsx(Button, { variant: "outline", size: "sm", className: "flex items-center gap-1.5", asChild: true, children: _jsxs("a", { href: downloadUrl, download: true, onClick: handleDownload, children: [_jsx(DownloadIcon, { size: 14 }), "Download schema"] }) }), _jsxs(DropdownMenu, { children: [_jsx(DropdownMenuTrigger, { asChild: true, children: _jsx(Button, { size: "sm", variant: "outline", className: "px-1.5", children: _jsx(ChevronDownIcon, { size: 14 }) }) }), _jsxs(DropdownMenuContent, { align: "end", children: [_jsx(DropdownMenuItem, { asChild: true, children: _jsxs("a", { href: downloadUrl, target: "_blank", rel: "noopener noreferrer", children: [_jsx(ExternalLinkIcon, { size: 14 }), "Open in new tab"] }) }), _jsxs(DropdownMenuItem, { onClick: async () => {
                                    const response = await fetch(downloadUrl);
                                    const schema = await response.text();
                                    copyToClipboard(schema);
                                }, children: [_jsx(CopyIcon, { size: 14 }), "Copy to clipboard"] }), _jsxs(DropdownMenuItem, { onClick: () => {
                                    const prompt = encodeURIComponent(`Help me understand this API: ${new URL(downloadUrl, window.location.href).href}`);
                                    window.open(`https://claude.ai/new?q=${prompt}`, "_blank");
                                }, children: [_jsx(ClaudeLogo, { className: "size-4" }), "Use in Claude"] }), _jsxs(DropdownMenuItem, { onClick: () => {
                                    const prompt = encodeURIComponent(`Help me understand this API: ${new URL(downloadUrl, window.location.href).href}`);
                                    window.open(`https://chatgpt.com/?q=${prompt}`, "_blank");
                                }, children: [_jsx(ChatGPTLogo, { className: "size-4" }), "Use in ChatGPT"] })] })] })] }));
};
//# sourceMappingURL=DownloadSchemaButton.js.map