import { jsx as _jsx, jsxs as _jsxs } from "react/jsx-runtime";
import { Unlink2Icon } from "lucide-react";
import { useFormContext } from "react-hook-form";
import { Checkbox } from "zudoku/ui/Checkbox.js";
import { Collapsible, CollapsibleContent } from "zudoku/ui/Collapsible.js";
import { Autocomplete } from "../../../components/Autocomplete.js";
import { CollapsibleHeader, CollapsibleHeaderTrigger, } from "./CollapsibleHeader.js";
import ParamsGrid, { ParamsGridInput, ParamsGridItem, ParamsGridRemoveButton, } from "./ParamsGrid.js";
import { useKeyValueFieldManager } from "./request-panel/useKeyValueFieldManager.js";
export const QueryParams = ({ control, schemaQueryParams, }) => {
    const { watch } = useFormContext();
    const watchedQueryParams = watch("queryParams");
    const manager = useKeyValueFieldManager({
        control,
        name: "queryParams",
        defaultValue: { name: "", value: "", active: false },
    });
    const requiredFields = schemaQueryParams.map((param) => Boolean(param.isRequired));
    const hasSchemaParams = schemaQueryParams.length > 0;
    return (_jsxs(Collapsible, { defaultOpen: true, children: [_jsxs(CollapsibleHeaderTrigger, { children: [_jsx(Unlink2Icon, { size: 16 }), _jsx(CollapsibleHeader, { children: "Query Parameters" })] }), _jsx(CollapsibleContent, { className: "CollapsibleContent", children: _jsx(ParamsGrid, { children: manager.fields.map((field, i) => {
                        const currentParam = schemaQueryParams.find((param) => param.name === watchedQueryParams.at(i)?.name);
                        const hasEnum = currentParam?.enum && currentParam.enum.length > 0;
                        const nameInputProps = manager.getNameInputProps(i);
                        const valueInputProps = manager.getValueInputProps(i);
                        return (_jsxs(ParamsGridItem, { children: [_jsx(Checkbox, { ...manager.getCheckboxProps(i) }), !requiredFields[i] ? (hasSchemaParams ? (_jsx(ParamsGridInput, { asChild: true, children: _jsx(Autocomplete, { ...nameInputProps, value: String(manager.getValue(i, "name")), placeholder: "Name", options: schemaQueryParams.map((param) => param.name), onChange: (v) => manager.setValue(i, "name", v), onSelect: (v) => manager.setValue(i, "name", v, { focus: "next" }) }) })) : (_jsx(ParamsGridInput, { ...nameInputProps, placeholder: "Name" }))) : (_jsx(ParamsGridInput, { asChild: true, children: _jsxs("label", { className: "flex items-center cursor-pointer gap-1", htmlFor: `queryParams.${i}.active`, title: requiredFields[i] ? "Required field" : undefined, children: [watchedQueryParams[i]?.name, requiredFields[i] && _jsx("sup", { children: "\u00A0*" })] }) })), _jsxs("div", { className: "flex justify-between items-center", children: [!hasEnum ? (_jsx(ParamsGridInput, { placeholder: "Value", "aria-label": "Query parameter value", ...valueInputProps })) : (_jsx(ParamsGridInput, { asChild: true, children: _jsx(Autocomplete, { ...valueInputProps, value: String(manager.getValue(i, "value")), shouldFilter: false, options: currentParam.enum ?? [], onChange: (v) => manager.setValue(i, "value", v), onSelect: (v) => manager.setValue(i, "value", v, { focus: "next" }) }) })), _jsx(ParamsGridRemoveButton, { ...manager.getRemoveButtonProps(i) })] })] }, field.id));
                    }) }) })] }));
};
//# sourceMappingURL=QueryParams.js.map