import { jsx as _jsx, jsxs as _jsxs } from "react/jsx-runtime";
import { useMutation, useQuery } from "@tanstack/react-query";
import { CheckIcon, MailCheck, RefreshCw } from "lucide-react";
import { Navigate, useSearchParams } from "react-router";
import { ActionButton } from "zudoku/ui/ActionButton.js";
import { Alert, AlertDescription, AlertTitle } from "zudoku/ui/Alert.js";
import { Button } from "zudoku/ui/Button.js";
import { Card, CardContent, CardDescription, CardHeader, CardTitle, } from "zudoku/ui/Card.js";
import createVariantComponent from "../../util/createVariantComponent.js";
import { getRelativeRedirectUrl } from "../utils/relativeRedirectUrl.js";
export const EmailVerificationUi = ({ onResendVerification, onCheckVerification, }) => {
    const [searchParams] = useSearchParams();
    const redirectTo = searchParams.get("redirectTo");
    const relativeRedirectTo = getRelativeRedirectUrl(redirectTo);
    const resendMutation = useMutation({
        mutationFn: async () => {
            await onResendVerification();
        },
    });
    const checkVerificationMutation = useQuery({
        queryKey: ["check-verification"],
        queryFn: async () => {
            const isVerified = await onCheckVerification();
            return isVerified;
        },
    });
    const error = resendMutation.error ?? checkVerificationMutation.error ?? null;
    return (_jsxs(AuthCard, { children: [checkVerificationMutation.data === true && (_jsx(Navigate, { to: relativeRedirectTo })), _jsxs(CardHeader, { className: "text-center", children: [_jsx("div", { className: "mx-auto mb-4 flex h-16 w-16 items-center justify-center rounded-full bg-primary/10", children: _jsx(MailCheck, { className: "h-8 w-8 text-primary" }) }), _jsx(CardTitle, { children: "Verify your email" }), _jsx(CardDescription, { children: "We've sent a verification link" })] }), _jsxs(CardContent, { className: "flex flex-col gap-4", children: [error && (_jsxs(Alert, { variant: "destructive", children: [_jsx(AlertTitle, { children: "Error" }), _jsx(AlertDescription, { children: error?.message })] })), resendMutation.isSuccess && (_jsxs(Alert, { children: [_jsx(AlertTitle, { children: "Email sent" }), _jsx(AlertDescription, { children: "A new verification email has been sent. Please check your inbox." })] })), checkVerificationMutation.isSuccess &&
                        !checkVerificationMutation.data && (_jsx(Alert, { children: _jsx(AlertDescription, { children: checkVerificationMutation.isFetching
                                ? "Checking verification..."
                                : "Your email hasn't been verified yet. Please check your inbox and click the verification link." }) })), _jsxs("div", { className: "space-y-4", children: [_jsx(ActionButton, { onClick: () => void checkVerificationMutation.refetch(), isPending: checkVerificationMutation.isFetching, className: "w-full", children: _jsxs("div", { className: "flex items-center gap-2", children: [_jsx(CheckIcon, { className: "h-4 w-4" }), " Continue"] }) }), _jsxs("div", { className: "relative", children: [_jsx("div", { className: "absolute inset-0 flex items-center", children: _jsx("span", { className: "w-full border-t" }) }), _jsx("div", { className: "relative flex justify-center text-sm", children: _jsx("span", { className: "bg-card px-2 text-muted-foreground", children: "Didn't receive the email?" }) })] }), _jsxs(Button, { variant: "outline", onClick: () => void resendMutation.mutate(), disabled: resendMutation.isPending, className: "w-full gap-2", children: [resendMutation.isPending ? (_jsx(RefreshCw, { className: "h-4 w-4 animate-spin" })) : (_jsx(RefreshCw, { className: "h-4 w-4" })), "Resend verification email"] })] }), _jsx("p", { className: "text-center text-xs text-muted-foreground", children: "Make sure to check your spam folder if you don't see the email." })] })] }));
};
const AuthCard = createVariantComponent(Card, "max-w-md w-full mt-10 mx-auto");
//# sourceMappingURL=EmailVerificationUi.js.map