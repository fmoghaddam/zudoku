import { isValidElement } from "react";
import { isTransformConfigPlugin } from "./plugins.js";
export const isPlainObject = (value) => typeof value === "object" &&
    value !== null &&
    !Array.isArray(value) &&
    Object.getPrototypeOf(value) === Object.prototype;
export const mergeConfig = (target, source) => {
    const result = { ...target };
    for (const key of Object.keys(source)) {
        const sourceValue = source[key];
        const targetValue = target[key];
        // Don't merge React elements, arrays, or non-plain objects - just replace
        if (isValidElement(sourceValue) ||
            Array.isArray(sourceValue) ||
            !isPlainObject(sourceValue)) {
            result[key] = sourceValue;
        }
        else if (isPlainObject(targetValue)) {
            result[key] = mergeConfig(targetValue, sourceValue);
        }
        else {
            result[key] = sourceValue;
        }
    }
    return result;
};
export const runPluginTransformConfig = async (config) => {
    const plugins = config.plugins ?? [];
    let result = config;
    for (const plugin of plugins.filter(isTransformConfigPlugin)) {
        const merge = (partial) => mergeConfig(result, partial);
        const transformed = await plugin.transformConfig?.({
            config: result,
            merge,
        });
        if (!transformed)
            continue;
        result = transformed;
    }
    return result;
};
//# sourceMappingURL=transform-config.js.map