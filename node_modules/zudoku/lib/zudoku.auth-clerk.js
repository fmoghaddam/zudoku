import { j as r } from "./jsx-runtime-BzflLqGi.js";
import { LogOutIcon as p } from "lucide-react";
import { S as h, a as y, b as U } from "./SignUp-2kBWzyaB.js";
import { u as n } from "./ZudokuReactContext-DGJAP1sN.js";
const x = ({
  clerkPubKey: c,
  jwtTemplateName: g,
  redirectToAfterSignOut: d = "/",
  redirectToAfterSignUp: o,
  redirectToAfterSignIn: a
}) => {
  let t;
  const i = (async () => {
    if (typeof window > "u") return;
    const { Clerk: e } = await import("@clerk/clerk-js");
    return t = new e(c), await t.load(), t;
  })();
  async function u() {
    if (await i, !t?.session)
      throw new Error("No session available");
    const e = await t.session.getToken({
      template: g
    });
    if (!e)
      throw new Error("Could not get access token from Clerk");
    return e;
  }
  async function l(e) {
    if (!e.session?.user)
      return;
    const s = e.session?.user?.emailAddresses.find(
      (m) => m.verification.status === "verified"
    );
    return {
      sub: e.session?.user?.id ?? "",
      email: s?.emailAddress ?? e.session?.user?.emailAddresses[0]?.emailAddress ?? "",
      name: e.session?.user?.fullName ?? "",
      emailVerified: !!s?.emailAddress,
      pictureUrl: e.session?.user?.imageUrl ?? ""
    };
  }
  async function w() {
    const e = await i;
    if (!e)
      return !1;
    await e.session?.user?.reload();
    const s = await l(e);
    return s ? (n.setState({
      isAuthenticated: !0,
      isPending: !1,
      profile: s,
      providerData: {
        user: e.session?.user
      }
    }), !0) : !1;
  }
  async function f(e) {
    const s = await u();
    return e.headers.set("Authorization", `Bearer ${s}`), e;
  }
  return {
    getRoutes: () => [
      {
        path: "/signout",
        element: /* @__PURE__ */ r.jsx(h, {})
      },
      {
        path: "/signin",
        element: /* @__PURE__ */ r.jsx(y, {})
      },
      {
        path: "/signup",
        element: /* @__PURE__ */ r.jsx(U, {})
      }
    ],
    refreshUserProfile: w,
    getProfileMenuItems() {
      return [
        {
          label: "Logout",
          path: "/signout",
          category: "bottom",
          icon: p
        }
      ];
    },
    initialize: async () => {
      const e = await i;
      if (e)
        if (e.session) {
          const s = await l(e);
          if (!s) {
            n.getState().setLoggedOut();
            return;
          }
          n.getState().setLoggedIn({
            profile: s,
            providerData: {
              user: e.session.user
            }
          });
        } else
          n.getState().setLoggedOut();
    },
    getAccessToken: u,
    signRequest: f,
    signOut: async () => {
      await i, n.getState().setLoggedOut(), await t?.signOut({
        redirectUrl: window.location.origin + d
      });
    },
    signIn: async (e, { redirectTo: s } = {}) => {
      await i, await t?.redirectToSignIn({
        signInForceRedirectUrl: a ? window.location.origin + a : s,
        signUpForceRedirectUrl: o ? window.location.origin + o : s
      });
    },
    signUp: async (e, { redirectTo: s } = {}) => {
      await i, await t?.redirectToSignUp({
        signInForceRedirectUrl: a ? window.location.origin + a : s,
        signUpForceRedirectUrl: o ? window.location.origin + o : s
      });
    }
  };
};
export {
  x as default
};
//# sourceMappingURL=zudoku.auth-clerk.js.map
