{"version":3,"file":"OasProvider-D_N0fTah.js","sources":["../src/lib/plugins/openapi/OasProvider.tsx"],"sourcesContent":["import { useMemo } from \"react\";\nimport { Outlet } from \"react-router\";\nimport { joinUrl } from \"../../util/joinUrl.js\";\nimport type { GraphQLClient } from \"./client/GraphQLClient.js\";\nimport { GraphQLProvider } from \"./client/GraphQLContext.js\";\nimport { OasConfigProvider } from \"./context.js\";\nimport type { OasPluginConfig } from \"./interfaces.js\";\nimport { getVersionMetadata } from \"./util/getRoutes.js\";\n\nexport const OasProvider = ({\n  basePath,\n  version,\n  config,\n  client,\n}: {\n  basePath: string;\n  version?: string;\n  config: OasPluginConfig;\n  client: GraphQLClient;\n}) => {\n  const value = useMemo(() => {\n    const {\n      versions: availableVersions,\n      labels,\n      downloadUrls,\n    } = getVersionMetadata(config);\n    const currentVersion = version ?? availableVersions.at(0);\n\n    const versionLinks = Object.fromEntries(\n      availableVersions.map((id) => [\n        id,\n        {\n          path: joinUrl(basePath, id),\n          label: labels[id] ?? id,\n          downloadUrl: downloadUrls[id],\n        },\n      ]),\n    );\n\n    const resolveInput = (): string | (() => Promise<unknown>) => {\n      if (!Array.isArray(config.input)) {\n        return config.input;\n      }\n\n      const versionConfig = currentVersion\n        ? config.input.find((v) => v.path === currentVersion)\n        : config.input[0];\n\n      if (!versionConfig) {\n        throw new Error(`No input found for version: ${currentVersion}`);\n      }\n\n      return versionConfig.input;\n    };\n\n    return {\n      config: {\n        ...config,\n        version: currentVersion,\n        versions: versionLinks,\n        input: resolveInput(),\n      },\n    };\n  }, [config, basePath, version]);\n\n  return (\n    <OasConfigProvider value={value}>\n      <GraphQLProvider client={client}>\n        <Outlet />\n      </GraphQLProvider>\n    </OasConfigProvider>\n  );\n};\n"],"names":["OasProvider","basePath","version","config","client","value","useMemo","availableVersions","labels","downloadUrls","getVersionMetadata","currentVersion","versionLinks","id","joinUrl","versionConfig","jsx","OasConfigProvider","GraphQLProvider","Outlet"],"mappings":";;;;;AASO,MAAMA,IAAc,CAAC;AAAA,EAC1B,UAAAC;AAAA,EACA,SAAAC;AAAA,EACA,QAAAC;AAAA,EACA,QAAAC;AACF,MAKM;AACJ,QAAMC,IAAQC,EAAQ,MAAM;AAC1B,UAAM;AAAA,MACJ,UAAUC;AAAA,MACV,QAAAC;AAAA,MACA,cAAAC;AAAA,IAAA,IACEC,EAAmBP,CAAM,GACvBQ,IAAiBT,KAAWK,EAAkB,GAAG,CAAC,GAElDK,IAAe,OAAO;AAAA,MAC1BL,EAAkB,IAAI,CAACM,MAAO;AAAA,QAC5BA;AAAA,QACA;AAAA,UACE,MAAMC,EAAQb,GAAUY,CAAE;AAAA,UAC1B,OAAOL,EAAOK,CAAE,KAAKA;AAAA,UACrB,aAAaJ,EAAaI,CAAE;AAAA,QAAA;AAAA,MAC9B,CACD;AAAA,IAAA;AAmBH,WAAO;AAAA,MACL,QAAQ;AAAA,QACN,GAAGV;AAAA,QACH,SAASQ;AAAA,QACT,UAAUC;AAAA,QACV,QArBiB,MAAyC;AAC5D,cAAI,CAAC,MAAM,QAAQT,EAAO,KAAK;AAC7B,mBAAOA,EAAO;AAGhB,gBAAMY,IAAgBJ,IAClBR,EAAO,MAAM,KAAK,CAAC,MAAM,EAAE,SAASQ,CAAc,IAClDR,EAAO,MAAM,CAAC;AAElB,cAAI,CAACY;AACH,kBAAM,IAAI,MAAM,+BAA+BJ,CAAc,EAAE;AAGjE,iBAAOI,EAAc;AAAA,QACvB,GAOW;AAAA,MAAa;AAAA,IACtB;AAAA,EAEJ,GAAG,CAACZ,GAAQF,GAAUC,CAAO,CAAC;AAE9B,SACEc,gBAAAA,EAAAA,IAACC,KAAkB,OAAAZ,GACjB,UAAAW,gBAAAA,EAAAA,IAACE,KAAgB,QAAAd,GACf,UAAAY,gBAAAA,EAAAA,IAACG,GAAA,CAAA,CAAO,EAAA,CACV,EAAA,CACF;AAEJ;"}