{"version":3,"file":"hook-BqOwTUgE.js","sources":["../src/lib/authentication/hook.ts"],"sourcesContent":["import { useQuery } from \"@tanstack/react-query\";\nimport { useNavigate } from \"react-router\";\nimport { useZudoku } from \"../components/context/ZudokuContext.js\";\nimport type { AuthActionOptions } from \"./authentication.js\";\nimport { useAuthState } from \"./state.js\";\n\nexport type UseAuthReturn = ReturnType<typeof useAuth>;\n\n/**\n * Refreshes the user profile from the authentication provider.\n *\n * This gets called when the user profile needs to be refreshed (e.g. to check if the email is verified)\n */\nexport const useRefreshUserProfile = ({\n  refetchOnWindowFocus,\n}: {\n  refetchOnWindowFocus?: boolean | \"always\";\n} = {}) => {\n  const { authentication } = useZudoku();\n  const isAuthEnabled = typeof authentication !== \"undefined\";\n\n  return useQuery({\n    refetchOnWindowFocus,\n    queryKey: [\"refresh-user-profile\"],\n    enabled:\n      isAuthEnabled && typeof authentication?.refreshUserProfile === \"function\",\n    queryFn: () => authentication?.refreshUserProfile?.(),\n  });\n};\n\nexport const useVerifiedEmail = () => {\n  const { authentication } = useZudoku();\n  const authState = useAuthState();\n  const navigate = useNavigate();\n  const isAuthEnabled = typeof authentication !== \"undefined\";\n\n  const { refetch: refreshUserProfile } = useRefreshUserProfile({\n    refetchOnWindowFocus: \"always\",\n  });\n\n  return {\n    email: authState.profile?.email,\n    isVerified: authState.profile?.emailVerified,\n    supportsEmailVerification:\n      typeof authentication?.requestEmailVerification === \"function\",\n    refresh: () => void refreshUserProfile(),\n    requestEmailVerification: async (options?: AuthActionOptions) => {\n      if (process.env.NODE_ENV === \"development\") {\n        // biome-ignore lint: We want to warn about the deprecation\n        console.warn(\n          \"requestEmailVerification is deprecated. Use useVerifiedEmail.\",\n        );\n      }\n      if (!isAuthEnabled) {\n        throw new Error(\"Authentication is not enabled.\");\n      }\n\n      await authentication.requestEmailVerification?.(\n        { navigate },\n        {\n          ...options,\n          redirectTo: options?.redirectTo ?? window.location.href,\n        },\n      );\n    },\n  };\n};\n\nexport const useAuth = () => {\n  const { authentication } = useZudoku();\n  const authState = useAuthState();\n  const isAuthEnabled = typeof authentication !== \"undefined\";\n  const navigate = useNavigate();\n\n  useRefreshUserProfile();\n\n  return {\n    isAuthEnabled,\n    ...authState,\n\n    login: async (options?: AuthActionOptions) => {\n      if (!isAuthEnabled) {\n        throw new Error(\"Authentication is not enabled.\");\n      }\n      // TODO: Should handle errors/state\n      await authentication.signIn(\n        { navigate },\n        {\n          ...options,\n          redirectTo: options?.redirectTo ?? window.location.href,\n        },\n      );\n    },\n\n    logout: async () => {\n      if (!isAuthEnabled) {\n        throw new Error(\"Authentication is not enabled.\");\n      }\n      // TODO: Should handle errors/state\n      await authentication.signOut({ navigate });\n\n      // Redirect to home\n      void navigate(\"/\", { replace: true });\n    },\n\n    signup: async (options?: AuthActionOptions) => {\n      if (!isAuthEnabled) {\n        throw new Error(\"Authentication is not enabled.\");\n      }\n      await authentication.signUp(\n        { navigate },\n        {\n          ...options,\n          redirectTo: options?.redirectTo ?? window.location.href,\n        },\n      );\n    },\n\n    requestEmailVerification: async (options?: AuthActionOptions) => {\n      if (process.env.NODE_ENV === \"development\") {\n        // biome-ignore lint: We want to warn about the deprecation\n        console.warn(\n          \"requestEmailVerification is deprecated on useAuth. Use the requestEmailVerification method from useVerifiedEmail hook instead.\",\n        );\n      }\n      if (!isAuthEnabled) {\n        throw new Error(\"Authentication is not enabled.\");\n      }\n\n      await authentication.requestEmailVerification?.(\n        { navigate },\n        {\n          ...options,\n          redirectTo: options?.redirectTo ?? window.location.href,\n        },\n      );\n    },\n  };\n};\n"],"names":["useRefreshUserProfile","refetchOnWindowFocus","authentication","useZudoku","useQuery","useVerifiedEmail","authState","useAuthState","navigate","useNavigate","isAuthEnabled","refreshUserProfile","options","useAuth"],"mappings":";;;;AAaO,MAAMA,IAAwB,CAAC;AAAA,EACpC,sBAAAC;AACF,IAEI,OAAO;AACT,QAAM,EAAE,gBAAAC,EAAA,IAAmBC,EAAA;AAG3B,SAAOC,EAAS;AAAA,IACd,sBAAAH;AAAA,IACA,UAAU,CAAC,sBAAsB;AAAA,IACjC,SALoB,OAAOC,IAAmB,OAM3B,OAAOA,GAAgB,sBAAuB;AAAA,IACjE,SAAS,MAAMA,GAAgB,qBAAA;AAAA,EAAqB,CACrD;AACH,GAEaG,IAAmB,MAAM;AACpC,QAAM,EAAE,gBAAAH,EAAA,IAAmBC,EAAA,GACrBG,IAAYC,EAAA,GACZC,IAAWC,EAAA,GACXC,IAAgB,OAAOR,IAAmB,KAE1C,EAAE,SAASS,EAAA,IAAuBX,EAAsB;AAAA,IAC5D,sBAAsB;AAAA,EAAA,CACvB;AAED,SAAO;AAAA,IACL,OAAOM,EAAU,SAAS;AAAA,IAC1B,YAAYA,EAAU,SAAS;AAAA,IAC/B,2BACE,OAAOJ,GAAgB,4BAA6B;AAAA,IACtD,SAAS,MAAM,KAAKS,EAAA;AAAA,IACpB,0BAA0B,OAAOC,MAAgC;AAO/D,UANI,QAAQ,IAAI,aAAa,iBAE3B,QAAQ;AAAA,QACN;AAAA,MAAA,GAGA,CAACF;AACH,cAAM,IAAI,MAAM,gCAAgC;AAGlD,YAAMR,EAAe;AAAA,QACnB,EAAE,UAAAM,EAAA;AAAA,QACF;AAAA,UACE,GAAGI;AAAA,UACH,YAAYA,GAAS,cAAc,OAAO,SAAS;AAAA,QAAA;AAAA,MACrD;AAAA,IAEJ;AAAA,EAAA;AAEJ,GAEaC,IAAU,MAAM;AAC3B,QAAM,EAAE,gBAAAX,EAAA,IAAmBC,EAAA,GACrBG,IAAYC,EAAA,GACZG,IAAgB,OAAOR,IAAmB,KAC1CM,IAAWC,EAAA;AAEjB,SAAAT,EAAA,GAEO;AAAA,IACL,eAAAU;AAAA,IACA,GAAGJ;AAAA,IAEH,OAAO,OAAOM,MAAgC;AAC5C,UAAI,CAACF;AACH,cAAM,IAAI,MAAM,gCAAgC;AAGlD,YAAMR,EAAe;AAAA,QACnB,EAAE,UAAAM,EAAA;AAAA,QACF;AAAA,UACE,GAAGI;AAAA,UACH,YAAYA,GAAS,cAAc,OAAO,SAAS;AAAA,QAAA;AAAA,MACrD;AAAA,IAEJ;AAAA,IAEA,QAAQ,YAAY;AAClB,UAAI,CAACF;AACH,cAAM,IAAI,MAAM,gCAAgC;AAGlD,YAAMR,EAAe,QAAQ,EAAE,UAAAM,GAAU,GAGpCA,EAAS,KAAK,EAAE,SAAS,IAAM;AAAA,IACtC;AAAA,IAEA,QAAQ,OAAOI,MAAgC;AAC7C,UAAI,CAACF;AACH,cAAM,IAAI,MAAM,gCAAgC;AAElD,YAAMR,EAAe;AAAA,QACnB,EAAE,UAAAM,EAAA;AAAA,QACF;AAAA,UACE,GAAGI;AAAA,UACH,YAAYA,GAAS,cAAc,OAAO,SAAS;AAAA,QAAA;AAAA,MACrD;AAAA,IAEJ;AAAA,IAEA,0BAA0B,OAAOA,MAAgC;AAO/D,UANI,QAAQ,IAAI,aAAa,iBAE3B,QAAQ;AAAA,QACN;AAAA,MAAA,GAGA,CAACF;AACH,cAAM,IAAI,MAAM,gCAAgC;AAGlD,YAAMR,EAAe;AAAA,QACnB,EAAE,UAAAM,EAAA;AAAA,QACF;AAAA,UACE,GAAGI;AAAA,UACH,YAAYA,GAAS,cAAc,OAAO,SAAS;AAAA,QAAA;AAAA,MACrD;AAAA,IAEJ;AAAA,EAAA;AAEJ;"}