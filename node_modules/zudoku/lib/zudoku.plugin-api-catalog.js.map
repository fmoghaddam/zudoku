{"version":3,"file":"zudoku.plugin-api-catalog.js","sources":["../src/lib/plugins/api-catalog/Catalog.tsx","../src/lib/plugins/api-catalog/index.tsx"],"sourcesContent":["import { useSuspenseQuery } from \"@tanstack/react-query\";\nimport { Helmet } from \"@zudoku/react-helmet-async\";\nimport { useMatch } from \"react-router\";\nimport { Link } from \"zudoku/components\";\nimport { useAuthState } from \"../../authentication/state.js\";\nimport { Heading } from \"../../components/Heading.js\";\nimport { Markdown } from \"../../components/Markdown.js\";\nimport { joinUrl } from \"../../util/joinUrl.js\";\nimport { type ApiCatalogPluginOptions, getKey } from \"./index.js\";\n\nexport const Catalog = ({\n  items,\n  filterCatalogItems = (items) => items,\n  label = \"API Library\",\n  categoryLabel,\n}: Omit<ApiCatalogPluginOptions, \"path\"> & {\n  categoryLabel?: string;\n}) => {\n  const auth = useAuthState();\n  const match = useMatch({ path: \"/catalog/:category\" });\n  const activeCategory = match?.params.category;\n\n  const catalogItems = useSuspenseQuery({\n    queryFn: () => filterCatalogItems(items, { auth }),\n    queryKey: [\"catalogItems\", auth],\n  });\n\n  // Only index the overview page, ignore the rest\n  const dataSet = activeCategory ? { \"data-pagefind-ignore\": \"all\" } : {};\n\n  return (\n    <section className=\"pt-(--padding-content-top)\" {...dataSet}>\n      <Helmet>\n        <title>\n          {categoryLabel ? `${categoryLabel} - ` : \"\"}\n          {label}\n        </title>\n      </Helmet>\n      <div className=\"grid gap-4\">\n        <Heading level={2}>\n          {label}\n          {categoryLabel && ` - ${categoryLabel}`}\n        </Heading>\n\n        <div className=\"grid grid-cols-2 gap-4\">\n          {catalogItems.data\n            .filter(\n              (api) =>\n                !activeCategory ||\n                api.categories.find((c) =>\n                  c.tags.find((t) => getKey(c.label, t) === activeCategory),\n                ),\n            )\n            .map((api) => (\n              <Link\n                to={joinUrl(api.path)}\n                className=\"no-underline hover:!text-foreground\"\n                key={api.path}\n              >\n                <div className=\"border h-full rounded-lg p-4 flex flex-col gap-2 cursor-pointer hover:bg-border/20 font-normal\">\n                  <span className=\"font-semibold\">{api.label}</span>\n                  <Markdown\n                    className=\"text-sm whitespace-pre-wrap mb-6 line-clamp-2\"\n                    content={api.description}\n                    components={{\n                      // Because we're wrapping the description in a Link already,\n                      // we need to strip out other links to not get a hydration error, like:\n                      // > In HTML, <a> cannot be a descendant of <a>.\n                      // > This will cause a hydration error.\n                      a: (props) => <span {...props} />,\n                    }}\n                  />\n                </div>\n              </Link>\n            ))}\n        </div>\n      </div>\n    </section>\n  );\n};\n","import slugify from \"@sindresorhus/slugify\";\nimport { matchPath } from \"react-router\";\nimport type { NavigationItem } from \"../../../config/validators/NavigationSchema.js\";\nimport type { AuthState } from \"../../authentication/state.js\";\nimport type { ZudokuPlugin } from \"../../core/plugins.js\";\nimport { joinUrl } from \"../../util/joinUrl.js\";\nimport { Catalog } from \"./Catalog.js\";\n\nexport const getKey = (category: string, tag: string) =>\n  slugify(`${category}-${tag}`);\n\nexport type ApiCatalogItem = {\n  path: string;\n  label: string;\n  description: string;\n  categories: CatalogCategory[];\n};\n\nexport type CatalogCategory = {\n  label: string;\n  tags: string[];\n};\n\nexport type ApiCatalogPluginOptions = {\n  path: string;\n  label: string;\n  categories?: CatalogCategory[];\n  items: ApiCatalogItem[];\n  filterCatalogItems?: FilterCatalogItemsFn;\n};\n\nexport type CatalogContext<ProviderData = unknown> = {\n  auth: AuthState<ProviderData>;\n};\n\nexport type FilterCatalogItemsFn<ProviderData = unknown> = (\n  items: ApiCatalogItem[],\n  { auth }: CatalogContext<ProviderData>,\n) => ApiCatalogItem[];\n\nexport const apiCatalogPlugin = ({\n  path,\n  items,\n  label,\n  categories = [],\n  filterCatalogItems,\n}: {\n  path: string;\n  label: string;\n  categories?: CatalogCategory[];\n  items: ApiCatalogItem[];\n  filterCatalogItems?: FilterCatalogItemsFn;\n}): ZudokuPlugin => {\n  const paths = Object.fromEntries(\n    categories.flatMap((category) =>\n      [undefined, ...category.tags].map((tag) => [\n        joinUrl(path, tag ? getKey(category.label, tag) : undefined),\n        tag,\n      ]),\n    ),\n  );\n\n  return {\n    getNavigation: async (currentPath) => {\n      const matches = Object.keys(paths).some((path) =>\n        matchPath(path, currentPath),\n      );\n\n      if (!matches) {\n        return [];\n      }\n\n      const navigation: NavigationItem[] = categories.map((category) => ({\n        type: \"category\",\n        label: category.label,\n        collapsible: false,\n        items: category.tags.map((tag) => ({\n          type: \"link\",\n          to: joinUrl(path, getKey(category.label, tag)),\n          label: tag,\n          badge: {\n            label: String(\n              items.filter((api) =>\n                api.categories.find((c) => c.tags.includes(tag)),\n              ).length,\n            ),\n            color: \"outline\",\n          },\n        })),\n      }));\n\n      navigation.unshift({\n        type: \"link\",\n        to: joinUrl(path),\n        label: \"Overview\",\n        badge: { label: String(items.length), color: \"outline\" },\n      });\n\n      return navigation;\n    },\n    getRoutes: () =>\n      Object.entries(paths).map(([path, tag]) => ({\n        path,\n        element: (\n          <Catalog\n            label={label}\n            categoryLabel={tag}\n            items={items}\n            filterCatalogItems={filterCatalogItems}\n            categories={categories}\n          />\n        ),\n      })),\n  };\n};\n"],"names":["Catalog","items","filterCatalogItems","label","categoryLabel","auth","useAuthState","activeCategory","useMatch","catalogItems","useSuspenseQuery","dataSet","jsxs","jsx","Helmet","Heading","api","c","t","getKey","Link","joinUrl","Markdown","props","category","tag","slugify","apiCatalogPlugin","path","categories","paths","currentPath","matchPath","navigation"],"mappings":"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"}