{"version":3,"file":"OAuthErrorPage-CVyXV7cI.js","sources":["../src/lib/util/url.ts","../src/lib/authentication/components/CallbackHandler.tsx","../src/lib/authentication/components/OAuthErrorPage.tsx"],"sourcesContent":["/**\n * Normalizes a redirect URL by removing the origin and optionally the root path\n */\nexport function normalizeRedirectUrl(\n  redirectTo: string,\n  origin: string,\n  basePath: string = \"/\",\n): string {\n  if (!redirectTo.startsWith(origin)) {\n    return redirectTo;\n  }\n\n  if (basePath !== \"/\" && redirectTo.startsWith(origin + basePath)) {\n    return redirectTo.slice(origin.length + basePath.length);\n  }\n\n  return redirectTo.slice(origin.length);\n}\n","import { useSuspenseQuery } from \"@tanstack/react-query\";\nimport { Navigate } from \"react-router\";\nimport { useZudoku } from \"zudoku/components\";\nimport { joinUrl } from \"../../util/joinUrl.js\";\nimport { normalizeRedirectUrl } from \"../../util/url.js\";\nimport { OAuthAuthorizationError, type OAuthErrorType } from \"../errors.js\";\n\nexport function CallbackHandler({\n  handleCallback,\n}: {\n  handleCallback: () => Promise<string>;\n}) {\n  const { options } = useZudoku();\n  const executeCallback = useSuspenseQuery({\n    retry: false,\n    queryKey: [\"oauth-callback\", window.location.search],\n    queryFn: async () => {\n      const url = new URL(window.location.href);\n\n      const errorParam = url.searchParams.get(\"error\");\n      const errorDescription =\n        url.searchParams.get(\"error_description\") ?? undefined;\n      const errorUri = url.searchParams.get(\"error_uri\") ?? undefined;\n      if (errorParam) {\n        throw new OAuthAuthorizationError(\n          `OAuth error '${errorParam}': ${errorDescription}`,\n          {\n            error: errorParam as OAuthErrorType,\n            error_description: errorDescription,\n            error_uri: errorUri,\n          },\n        );\n      }\n      return joinUrl(\n        normalizeRedirectUrl(\n          await handleCallback(),\n          window.location.origin,\n          options.basePath,\n        ),\n      );\n    },\n  });\n\n  return <Navigate to={executeCallback.data} replace />;\n}\n","import { HomeIcon } from \"lucide-react\";\nimport { Link } from \"react-router\";\nimport { Heading } from \"../../components/Heading.js\";\nimport { Typography } from \"../../components/Typography.js\";\nimport { Button } from \"../../ui/Button.js\";\nimport { OAuthAuthorizationError } from \"../errors.js\";\nimport { useAuth } from \"../hook.js\";\n\nconst errorDetailsMap: Record<string, { message: string }> = {\n  invalid_request: {\n    message:\n      \"The authentication request was invalid. Please try signing in again.\",\n  },\n  unauthorized_client: {\n    message:\n      \"This application is not authorized to access your account. Please contact support.\",\n  },\n  access_denied: {\n    message:\n      \"You denied access to this application. To continue, please sign in and grant access.\",\n  },\n  unsupported_response_type: {\n    message:\n      \"The authentication method is not supported. Please contact support.\",\n  },\n  invalid_scope: {\n    message: \"The requested permissions are invalid. Please contact support.\",\n  },\n  server_error: {\n    message:\n      \"The authentication server encountered an error. Please try again in a few moments.\",\n  },\n  temporarily_unavailable: {\n    message:\n      \"The authentication service is temporarily unavailable. Please try again in a few moments.\",\n  },\n  // Token errors\n  invalid_client: {\n    message: \"Invalid application credentials. Please contact support.\",\n  },\n  invalid_grant: {\n    message:\n      \"The authentication code has expired or is invalid. Please sign in again.\",\n  },\n  unsupported_grant_type: {\n    message:\n      \"The authentication method is not supported. Please contact support.\",\n  },\n  // Custom errors\n  invalid_state: {\n    message:\n      \"Security validation failed. This may be due to a potential security attack. Please try signing in again.\",\n  },\n  missing_code_verifier: {\n    message:\n      \"Authentication security information is missing. Please clear your browser cache and try again.\",\n  },\n  network_error: {\n    message:\n      \"A network error occurred during authentication. Please check your connection and try again.\",\n  },\n  token_expired: {\n    message: \"Your authentication session has expired. Please sign in again.\",\n  },\n  configuration_error: {\n    message:\n      \"There is an issue with the authentication configuration. Please contact support.\",\n  },\n  unknown_error: {\n    message:\n      \"An unexpected error occurred during authentication. Please try again or contact support.\",\n  },\n};\n\nexport function OAuthErrorPage({ error }: { error: unknown }) {\n  const { login } = useAuth();\n\n  if (!(error instanceof OAuthAuthorizationError)) {\n    throw error;\n  }\n\n  const oauthError = error.error;\n  const type =\n    oauthError && typeof oauthError === \"object\" && \"error\" in oauthError\n      ? String(oauthError.error)\n      : \"unknown_error\";\n\n  const details = errorDetailsMap[type] ?? errorDetailsMap.unknown_error;\n\n  return (\n    <div className=\"min-h-[400px] flex items-center justify-center p-4\">\n      <div className=\"max-w-md w-full text-center space-y-6\">\n        <div className=\"space-y-4 items-center\">\n          <Heading level={2} className=\"text-2xl inline-block font-bold\">\n            {titles[type] || \"Authentication Error\"}\n          </Heading>\n\n          <Typography className=\"text-gray-600 dark:text-gray-300 leading-relaxed\">\n            {details?.message}\n          </Typography>\n\n          {/* Technical details for developers (only in development) */}\n        </div>\n\n        {/* Action Buttons */}\n        <div className=\"space-y-3 pt-4\">\n          <div className=\"space-y-2\">\n            {(type === \"access_denied\" ||\n              type === \"invalid_grant\" ||\n              type === \"token_expired\") && (\n              <Button\n                onClick={() => login()}\n                className=\"w-full capitalize\"\n                variant={\"default\"}\n              >\n                Sign in again\n              </Button>\n            )}\n          </div>\n\n          <div className=\"flex gap-2\">\n            <Button asChild className=\"flex-1\" variant=\"outline\">\n              <Link to=\"/\">\n                <HomeIcon className=\"w-4 h-4 mr-2\" />\n                Go Home\n              </Link>\n            </Button>\n          </div>\n        </div>\n\n        {/* Additional Help */}\n        {helpMessages[type] && (\n          <Typography className=\"text-sm text-gray-500 dark:text-gray-400\">\n            {helpMessages[type]}\n          </Typography>\n        )}\n      </div>\n    </div>\n  );\n}\n\nconst titles: Record<string, string> = {\n  access_denied: \"Access Denied\",\n  invalid_request: \"Invalid Request\",\n  unauthorized_client: \"Unauthorized Application\",\n  unsupported_response_type: \"Unsupported Method\",\n  invalid_scope: \"Invalid Permissions\",\n  server_error: \"Server Error\",\n  temporarily_unavailable: \"Service Unavailable\",\n  invalid_client: \"Invalid Credentials\",\n  invalid_grant: \"Authentication Expired\",\n  unsupported_grant_type: \"Unsupported Authentication\",\n  invalid_state: \"Security Check Failed\",\n  missing_code_verifier: \"Security Information Missing\",\n  network_error: \"Network Error\",\n  token_expired: \"Session Expired\",\n  configuration_error: \"Configuration Error\",\n  unknown_error: \"Authentication Failed\",\n};\n\nconst helpMessages: Record<string, string> = {\n  access_denied:\n    \"If you changed your mind, you can try signing in again to grant access.\",\n  invalid_state:\n    \"This error can occur if you have multiple tabs open or if your session was compromised.\",\n  missing_code_verifier:\n    \"Try clearing your browser's cache and cookies for this site.\",\n  network_error:\n    \"Check your internet connection and ensure you can access other websites.\",\n  server_error:\n    \"The issue is on our end. Our team has been notified and is working to fix it.\",\n  temporarily_unavailable:\n    \"This is usually temporary. Try again in a few minutes.\",\n};\n"],"names":["normalizeRedirectUrl","redirectTo","origin","basePath","CallbackHandler","handleCallback","options","useZudoku","executeCallback","useSuspenseQuery","url","errorParam","errorDescription","errorUri","OAuthAuthorizationError","joinUrl","Navigate","errorDetailsMap","OAuthErrorPage","error","login","useAuth","oauthError","type","details","jsxs","jsx","Heading","titles","Typography","Button","Link","HomeIcon","helpMessages"],"mappings":"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"}