{"version":3,"file":"zudoku.plugin-search-pagefind.js","sources":["../src/lib/ui/Kbd.tsx","../src/lib/plugins/search-pagefind/get-results.tsx","../src/lib/plugins/search-pagefind/ResultList.tsx","../src/lib/plugins/search-pagefind/PagefindSearch.tsx","../src/lib/plugins/search-pagefind/index.tsx"],"sourcesContent":["import { cn } from \"./util.js\";\n\nfunction Kbd({ className, ...props }: React.ComponentProps<\"kbd\">) {\n  return (\n    <kbd\n      data-slot=\"kbd\"\n      className={cn(\n        \"bg-muted text-muted-foreground pointer-events-none inline-flex h-5 w-fit min-w-5 items-center justify-center gap-1 rounded-sm px-1 font-sans text-xs font-medium select-none\",\n        \"[&_svg:not([class*='size-'])]:size-3\",\n        \"[[data-slot=tooltip-content]_&]:bg-background/20 [[data-slot=tooltip-content]_&]:text-background dark:[[data-slot=tooltip-content]_&]:bg-background/10\",\n        className,\n      )}\n      {...props}\n    />\n  );\n}\n\nfunction KbdGroup({ className, ...props }: React.ComponentProps<\"kbd\">) {\n  return (\n    <kbd\n      data-slot=\"kbd-group\"\n      className={cn(\"inline-flex items-center gap-1\", className)}\n      {...props}\n    />\n  );\n}\n\nexport { Kbd, KbdGroup };\n","import type { AuthState } from \"../../authentication/state.js\";\nimport type { ZudokuContext } from \"../../core/ZudokuContext.js\";\nimport type { PagefindOptions } from \"./index.js\";\nimport type { PagefindSearchFragment, PagefindSearchResults } from \"./types.js\";\n\nexport const getResults = async ({\n  search,\n  options,\n  auth,\n  context,\n}: {\n  search: PagefindSearchResults;\n  options: PagefindOptions;\n  auth: AuthState;\n  context: ZudokuContext;\n}) => {\n  const maxResults = options.maxResults ?? 10;\n  const transformFn = options.transformResults ?? (() => true);\n\n  const transformedResults: PagefindSearchFragment[] = [];\n\n  const generator = searchResultGenerator({\n    search,\n    transformFn,\n    auth,\n    context,\n  });\n\n  for await (const result of generator) {\n    transformedResults.push(result);\n    if (transformedResults.length >= maxResults) break;\n  }\n\n  return transformedResults;\n};\n\nasync function* searchResultGenerator({\n  search,\n  transformFn,\n  auth,\n  context,\n}: {\n  search: PagefindSearchResults;\n  transformFn: NonNullable<PagefindOptions[\"transformResults\"]>;\n  auth: AuthState<unknown>;\n  context: ZudokuContext;\n}) {\n  const batchSize = 5;\n  let processedCount = 0;\n\n  while (processedCount < search.results.length) {\n    const batch = search.results.slice(\n      processedCount,\n      processedCount + batchSize,\n    );\n    processedCount += batch.length;\n\n    const batchData = await Promise.all(batch.map((result) => result.data()));\n\n    for (const result of batchData) {\n      const transformed = transformFn({ result, auth, context });\n\n      if (transformed === false) {\n        // Skip this result\n      } else if (transformed === true || transformed == null) {\n        // Keep the original result\n        yield result;\n      } else {\n        // Return the transformed result\n        yield transformed;\n      }\n    }\n  }\n}\n","import { BracketsIcon, FileTextIcon } from \"lucide-react\";\nimport { useLayoutEffect, useRef } from \"react\";\nimport { Link, useNavigate } from \"react-router\";\nimport { CommandGroup, CommandItem, CommandList } from \"zudoku/ui/Command.js\";\nimport { joinUrl } from \"../../util/joinUrl.js\";\nimport type { PagefindSearchFragment, PagefindSubResult } from \"./types.js\";\n\nconst sortSubResults = (a: PagefindSubResult, b: PagefindSubResult) => {\n  const aScore = a.weighted_locations.reduce(\n    (sum, loc) => sum + loc.balanced_score,\n    0,\n  );\n  const bScore = b.weighted_locations.reduce(\n    (sum, loc) => sum + loc.balanced_score,\n    0,\n  );\n  return bScore - aScore;\n};\n\nconst hoverClassname = `cursor-pointer border border-transparent data-[selected=true]:border-border`;\n\nexport const ResultList = ({\n  basePath,\n  searchResults,\n  searchTerm,\n  onClose,\n  maxSubResults = 4,\n}: {\n  basePath?: string;\n  searchResults: PagefindSearchFragment[];\n  searchTerm: string;\n  onClose: () => void;\n  maxSubResults?: number;\n}) => {\n  const navigate = useNavigate();\n  const commandListRef = useRef<HTMLDivElement | null>(null);\n\n  useLayoutEffect(() => {\n    if (!searchTerm) return;\n    requestAnimationFrame(() => {\n      commandListRef.current?.scrollTo({ top: 0 });\n    });\n  }, [searchTerm]);\n\n  const stripBasePath = (url: string) => {\n    if (basePath && url.startsWith(basePath)) {\n      return joinUrl(url.slice(basePath.length));\n    }\n    return url;\n  };\n\n  return (\n    <CommandList className=\"max-h-[450px]\" ref={commandListRef}>\n      {searchTerm && searchResults.length > 0 && (\n        <CommandGroup\n          className=\"text-sm text-muted-foreground\"\n          heading={`${searchResults.length} results for \"${searchTerm}\"`}\n        />\n      )}\n      {searchTerm &&\n        searchResults.map((result) => (\n          <CommandGroup\n            key={[result.meta.title ?? result.excerpt, result.url].join(\"-\")}\n          >\n            <CommandItem\n              asChild\n              value={`${result.meta.title}-${result.url}`}\n              className={hoverClassname}\n              onSelect={() => {\n                void navigate(stripBasePath(result.url));\n                onClose();\n              }}\n            >\n              <Link to={stripBasePath(result.url)}>\n                {result.meta.section === \"openapi\" ? (\n                  <BracketsIcon />\n                ) : (\n                  <FileTextIcon />\n                )}\n                {result.meta.category && (\n                  <span className=\"text-muted-foreground\">\n                    {result.meta.category} &rsaquo;{\" \"}\n                  </span>\n                )}\n                {result.meta.title}\n              </Link>\n            </CommandItem>\n            {result.sub_results\n              .sort(sortSubResults)\n              .slice(0, maxSubResults)\n              .map((subResult) => (\n                <CommandItem\n                  asChild\n                  key={`sub-${result.meta.title}-${subResult.url}`}\n                  value={`sub-${result.meta.title}-${subResult.url}`}\n                  className={hoverClassname}\n                  onSelect={() => {\n                    void navigate(stripBasePath(subResult.url));\n                    onClose();\n                  }}\n                >\n                  <Link to={stripBasePath(subResult.url)} onClick={onClose}>\n                    <div className=\"flex flex-col items-start gap-2 ms-2.5 ps-5 border-l border-muted-foreground/50\">\n                      <span className=\"font-bold\">{subResult.title}</span>\n                      <span\n                        className=\"line-clamp-2 text-[13px] [&_mark]:bg-primary [&_mark]:text-primary-foreground\"\n                        // biome-ignore lint/security/noDangerouslySetInnerHtml: Pagefind provides sanitized HTML\n                        dangerouslySetInnerHTML={{ __html: subResult.excerpt }}\n                      />\n                    </div>\n                  </Link>\n                </CommandItem>\n              ))}\n          </CommandGroup>\n        ))}\n    </CommandList>\n  );\n};\n","import { VisuallyHidden } from \"@radix-ui/react-visually-hidden\";\nimport { keepPreviousData, useQuery } from \"@tanstack/react-query\";\nimport { ListPlusIcon } from \"lucide-react\";\nimport { lazy, useEffect, useRef, useState } from \"react\";\nimport { Button } from \"zudoku/ui/Button.js\";\nimport {\n  CommandDialog,\n  CommandEmpty,\n  CommandInput,\n} from \"zudoku/ui/Command.js\";\nimport { DialogTitle } from \"zudoku/ui/Dialog.js\";\nimport { Kbd, KbdGroup } from \"zudoku/ui/Kbd.js\";\nimport { useAuthState } from \"../../authentication/state.js\";\nimport { useZudoku } from \"../../components/context/ZudokuContext.js\";\nimport { SEARCH_PROTECTED_SECTION } from \"../../core/RouteGuard.js\";\nimport { joinUrl } from \"../../util/joinUrl.js\";\nimport { getResults } from \"./get-results.js\";\nimport type { PagefindOptions } from \"./index.js\";\nimport { ResultList } from \"./ResultList.js\";\nimport type { Pagefind } from \"./types.js\";\n\nconst IndexingDialog = lazy(() => import(\"./IndexingDialog.js\"));\n\nconst DEFAULT_RANKING = {\n  // Slightly lower than default because API docs tend to have repetitive terms (parameter names, HTTP methods, etc.)\n  termFrequency: 0.8,\n  // Lower than default because API documentation pages tend to be longer due to comprehensive endpoint documentation\n  pageLength: 0.6,\n  // Slightly higher than default because in technical documentation, exact matches should be prioritized\n  termSimilarity: 1.2,\n  // Slightly lower than default because API docs might have legitimate repetition of terms\n  termSaturation: 1.2,\n};\n\nconst importPagefind = (basePath?: string): Promise<Pagefind> =>\n  import.meta.env.DEV\n    ? // @ts-expect-error TypeScript can't resolve the import\n      import(/* @vite-ignore */ \"/pagefind/pagefind.js\")\n    : import(/* @vite-ignore */ joinUrl(basePath, \"/pagefind/pagefind.js\"));\n\nconst usePagefind = (options: PagefindOptions) => {\n  const {\n    options: { basePath },\n  } = useZudoku();\n  const { data: pagefind, ...result } = useQuery<Pagefind>({\n    queryKey: [\"pagefind\", options.ranking],\n    retry: false,\n    queryFn: async () => {\n      const pagefind = await importPagefind(basePath);\n      await pagefind.init();\n      await pagefind.options({\n        ranking: {\n          termFrequency:\n            options.ranking?.termFrequency ?? DEFAULT_RANKING.termFrequency,\n          pageLength: options.ranking?.pageLength ?? DEFAULT_RANKING.pageLength,\n          termSimilarity:\n            options.ranking?.termSimilarity ?? DEFAULT_RANKING.termSimilarity,\n          termSaturation:\n            options.ranking?.termSaturation ?? DEFAULT_RANKING.termSaturation,\n        },\n      });\n\n      return pagefind;\n    },\n    enabled: typeof window !== \"undefined\",\n  });\n\n  if (result.isError && result.error.message !== \"NOT_BUILT_YET\") {\n    // biome-ignore lint/suspicious/noConsole: Logging allowed here\n    console.error(result.error);\n  }\n\n  return { ...result, pagefind };\n};\n\nexport const PagefindSearch = ({\n  isOpen,\n  onClose,\n  options,\n}: {\n  isOpen: boolean;\n  onClose: () => void;\n  options: PagefindOptions;\n}) => {\n  const { pagefind, error, isError } = usePagefind(options);\n  const [searchTerm, setSearchTerm] = useState(\"\");\n  const [selectedValue, setSelectedValue] = useState<string>(\"\");\n  const auth = useAuthState();\n  const context = useZudoku();\n  const inputRef = useRef<HTMLInputElement>(null);\n\n  const { data: searchResults } = useQuery({\n    queryKey: [\"pagefind-search\", searchTerm, auth.isAuthenticated],\n    queryFn: async () => {\n      const filters = auth.isAuthenticated\n        ? undefined\n        : { not: { section: SEARCH_PROTECTED_SECTION } };\n\n      const search = await pagefind?.search(searchTerm, { filters });\n      if (!search) return [];\n      return getResults({ search, options, auth, context });\n    },\n    placeholderData: keepPreviousData,\n    enabled: !!pagefind && !!searchTerm,\n  });\n\n  useEffect(() => {\n    if (!searchResults?.length) return;\n\n    const firstResult = searchResults.at(0);\n    if (!firstResult) return;\n\n    const firstValue = `${firstResult.meta.title}-${firstResult.url}`;\n    setSelectedValue(firstValue);\n  }, [searchResults]);\n\n  return (\n    <CommandDialog\n      command={{\n        shouldFilter: false,\n        loop: true,\n        value: selectedValue,\n        onValueChange: setSelectedValue,\n      }}\n      content={{ className: \"max-w-[750px]\" }}\n      open={isOpen}\n      onOpenChange={onClose}\n    >\n      <VisuallyHidden>\n        <DialogTitle>Search</DialogTitle>\n      </VisuallyHidden>\n      <CommandInput\n        ref={inputRef}\n        placeholder=\"Search...\"\n        value={searchTerm}\n        onValueChange={setSearchTerm}\n        disabled={isError}\n      />\n      <CommandEmpty>\n        {searchTerm ? (\n          <div className=\"flex flex-col items-center\">\n            No results found.\n            <Button\n              variant=\"link\"\n              onClick={() => {\n                setSearchTerm(\"\");\n                inputRef.current?.focus();\n              }}\n            >\n              Clear search\n            </Button>\n          </div>\n        ) : (\n          \"Start typing to search\"\n        )}\n      </CommandEmpty>\n      {isError && error.message !== \"NOT_BUILT_YET\" ? (\n        <div className=\"p-4 text-sm\">\n          An error occurred while loading search.\n        </div>\n      ) : (\n        <>\n          <ResultList\n            basePath={context.options.basePath}\n            searchResults={searchResults ?? []}\n            searchTerm={searchTerm}\n            onClose={onClose}\n            maxSubResults={options.maxSubResults}\n          />\n          <div className=\"flex justify-between p-2 items-center\">\n            <div className=\"flex items-center text-xs text-muted-foreground\">\n              <KbdGroup className=\"ms-0 me-1\">\n                <Kbd>↑</Kbd>\n                <Kbd>↓</Kbd>\n              </KbdGroup>\n              Navigate\n              <KbdGroup className=\"ms-4 me-1\">\n                <Kbd>↵</Kbd>\n              </KbdGroup>\n              Select\n              <KbdGroup className=\"ms-4 me-1\">\n                <Kbd>Esc</Kbd>\n              </KbdGroup>\n              Close dialog\n            </div>\n            {import.meta.env.DEV && (\n              <IndexingDialog>\n                <Button\n                  variant=\"outline\"\n                  className=\"h-7 text-xs text-muted-foreground\"\n                >\n                  <ListPlusIcon />\n                  Build Search Index\n                </Button>\n              </IndexingDialog>\n            )}\n          </div>\n        </>\n      )}\n    </CommandDialog>\n  );\n};\n","import type { ZudokuConfig } from \"../../../config/validators/validate.js\";\nimport { ClientOnly } from \"../../components/ClientOnly.js\";\nimport type { ZudokuPlugin } from \"../../core/plugins.js\";\nimport { PagefindSearch } from \"./PagefindSearch.js\";\n\nexport type PagefindOptions = Extract<\n  ZudokuConfig[\"search\"],\n  { type: \"pagefind\" }\n>;\n\nexport const pagefindSearchPlugin = (\n  options: PagefindOptions,\n): ZudokuPlugin => {\n  return {\n    renderSearch: ({ isOpen, onClose }) => (\n      <ClientOnly>\n        <PagefindSearch isOpen={isOpen} onClose={onClose} options={options} />\n      </ClientOnly>\n    ),\n  };\n};\n"],"names":["Kbd","className","props","jsx","cn","KbdGroup","getResults","search","options","auth","context","maxResults","transformFn","transformedResults","generator","searchResultGenerator","result","processedCount","batch","batchData","transformed","sortSubResults","a","b","aScore","sum","loc","hoverClassname","ResultList","basePath","searchResults","searchTerm","onClose","maxSubResults","navigate","useNavigate","commandListRef","useRef","useLayoutEffect","stripBasePath","url","joinUrl","jsxs","CommandList","CommandGroup","CommandItem","Link","BracketsIcon","FileTextIcon","subResult","lazy","DEFAULT_RANKING","importPagefind","usePagefind","useZudoku","pagefind","useQuery","PagefindSearch","isOpen","error","isError","setSearchTerm","useState","selectedValue","setSelectedValue","useAuthState","inputRef","filters","SEARCH_PROTECTED_SECTION","keepPreviousData","useEffect","firstResult","firstValue","CommandDialog","VisuallyHidden","DialogTitle","CommandInput","CommandEmpty","Button","Fragment","pagefindSearchPlugin","ClientOnly"],"mappings":"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"}